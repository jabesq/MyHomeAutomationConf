### SCRIPT ###

#Turn off TV/Hifi then turn it back on after 10 sec
reset_tv_hifi:
    alias: Reset TV and Hifi (to shutdown Hifi)
    sequence:
      - service: switch.turn_off
        data:
            entity_id: switch.tv_hifi
      - service: input_boolean.turn_on
        data:
            entity_id: input_boolean.tv_hifi_reset_done
      - delay:
            seconds: 10
      - alias: Restart TV and Hifi
        service: switch.turn_on
        data:
            entity_id: switch.tv_hifi
      - service: input_boolean.turn_off
        data:
            entity_id: input_boolean.reset_tv_hifi

#After 10 minutes, let's consider everybody leaves the room
timer_someone_seen:
    alias: person left after 10 minutes
    sequence:
      - delay:
            minutes: 10
      - alias: everybody left
        service: input_boolean.turn_off
        data:
            entity_id: input_boolean.someone_home

#Someone has been seen => (re)start the 10 min timer
someone_seen:
    alias: Someone has been seen
    sequence:
      - service: script.turn_off
        data:
            entity_id: script.timer_someone_seen
      - alias: Someone has been seen
        service: input_boolean.turn_on
        data:
            entity_id: input_boolean.someone_home
      - service: script.turn_on
        data:
            entity_id: script.timer_someone_seen

#reset the flags to their default value
reset_flags:
    sequence:
      - service: input_boolean.turn_off
        data:
            entity_id: input_boolean.reset_tv_hifi
      - service: input_boolean.turn_off
        data:
            entity_id: input_boolean.tv_hifi_reset_done
